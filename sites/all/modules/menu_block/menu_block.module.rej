***************
*** 4,11 ****
   * Provides configurable blocks of menu items.
   */
  
- // A core bug in Drupal 7.0 requires this fix.
- module_load_include('inc', 'menu_block', 'custom_menu_active_trail');
  
  /**
   * Denotes that the tree should use the menu picked by the curent page.
--- 4,14 ----
   * Provides configurable blocks of menu items.
   */
  
+ // A core bug fixed in Drupal 7.12.
+ // @see http://drupal.org/node/942782
+ if (!defined('MENU_PREFERRED_LINK')) {
+   module_load_include('inc', 'menu_block', 'custom_menu_active_trail');
+ }
  
  /**
   * Denotes that the tree should use the menu picked by the curent page.
***************
*** 309,315 ****
    menu_block_set_title(t($menu_names[$config['menu_name']]));
  
    // @TODO: Remove work-around for core bug #942782.
-   __menu_block_set_menu_trail($config['menu_name']);
  
    if ($config['expanded'] || $config['parent_mlid']) {
      // Get the full, un-pruned tree.
--- 312,320 ----
    menu_block_set_title(t($menu_names[$config['menu_name']]));
  
    // @TODO: Remove work-around for core bug #942782.
+   if (!defined('MENU_PREFERRED_LINK')) {
+     __menu_block_set_menu_trail($config['menu_name']);
+   }
  
    if ($config['expanded'] || $config['parent_mlid']) {
      // Get the full, un-pruned tree.
***************
*** 323,329 ****
    }
  
    // @TODO: Remove work-around for core bug #942782.
-   __menu_block_set_menu_trail();
  
    // Allow alteration of the tree and config before we begin operations on it.
    drupal_alter('menu_block_tree', $tree, $config);
--- 328,336 ----
    }
  
    // @TODO: Remove work-around for core bug #942782.
+   if (!defined('MENU_PREFERRED_LINK')) {
+     __menu_block_set_menu_trail();
+   }
  
    // Allow alteration of the tree and config before we begin operations on it.
    drupal_alter('menu_block_tree', $tree, $config);
